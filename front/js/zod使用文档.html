<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>zod使用文档总结汇总 | 大前端</title>
    <meta name="description" content="前端知识体系建设">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.bcf422a7.css" as="style"><link rel="preload" href="/assets/js/app.cb69e367.js" as="script"><link rel="preload" href="/assets/js/2.97e62447.js" as="script"><link rel="preload" href="/assets/js/19.e931611d.js" as="script"><link rel="prefetch" href="/assets/js/10.4feea8e6.js"><link rel="prefetch" href="/assets/js/11.d0f55222.js"><link rel="prefetch" href="/assets/js/12.78e61d7e.js"><link rel="prefetch" href="/assets/js/13.fc23d13b.js"><link rel="prefetch" href="/assets/js/14.1821acb8.js"><link rel="prefetch" href="/assets/js/15.aed09044.js"><link rel="prefetch" href="/assets/js/16.4595878b.js"><link rel="prefetch" href="/assets/js/17.2c66c4cb.js"><link rel="prefetch" href="/assets/js/18.d0927fc3.js"><link rel="prefetch" href="/assets/js/20.835e596e.js"><link rel="prefetch" href="/assets/js/21.e85ab81d.js"><link rel="prefetch" href="/assets/js/22.ffb1218f.js"><link rel="prefetch" href="/assets/js/23.25dc22c5.js"><link rel="prefetch" href="/assets/js/24.1b69242f.js"><link rel="prefetch" href="/assets/js/25.b8458ebd.js"><link rel="prefetch" href="/assets/js/26.5e4d1ef0.js"><link rel="prefetch" href="/assets/js/27.35707f38.js"><link rel="prefetch" href="/assets/js/28.454f3ece.js"><link rel="prefetch" href="/assets/js/29.9f919dde.js"><link rel="prefetch" href="/assets/js/3.ddeae314.js"><link rel="prefetch" href="/assets/js/30.06fb66c7.js"><link rel="prefetch" href="/assets/js/31.67eae056.js"><link rel="prefetch" href="/assets/js/32.6e083401.js"><link rel="prefetch" href="/assets/js/33.e4e4068c.js"><link rel="prefetch" href="/assets/js/34.14bb4422.js"><link rel="prefetch" href="/assets/js/35.52347c0c.js"><link rel="prefetch" href="/assets/js/36.b746d2f6.js"><link rel="prefetch" href="/assets/js/37.cadf6b91.js"><link rel="prefetch" href="/assets/js/38.d4685da1.js"><link rel="prefetch" href="/assets/js/39.c574b892.js"><link rel="prefetch" href="/assets/js/4.db7235d4.js"><link rel="prefetch" href="/assets/js/40.1fac81c8.js"><link rel="prefetch" href="/assets/js/41.ea31e6dd.js"><link rel="prefetch" href="/assets/js/42.4ad1d79f.js"><link rel="prefetch" href="/assets/js/43.143c80d2.js"><link rel="prefetch" href="/assets/js/44.eda7091f.js"><link rel="prefetch" href="/assets/js/45.513a1c1d.js"><link rel="prefetch" href="/assets/js/46.a03ae126.js"><link rel="prefetch" href="/assets/js/47.5d8a3c88.js"><link rel="prefetch" href="/assets/js/48.bc6fa5e4.js"><link rel="prefetch" href="/assets/js/49.14dc2ecc.js"><link rel="prefetch" href="/assets/js/5.50f8abaf.js"><link rel="prefetch" href="/assets/js/50.e2a14907.js"><link rel="prefetch" href="/assets/js/51.91d9ca44.js"><link rel="prefetch" href="/assets/js/52.de014759.js"><link rel="prefetch" href="/assets/js/53.b0cf3bbb.js"><link rel="prefetch" href="/assets/js/54.c3d0e3db.js"><link rel="prefetch" href="/assets/js/55.40caf057.js"><link rel="prefetch" href="/assets/js/56.e6016740.js"><link rel="prefetch" href="/assets/js/57.5c3e9644.js"><link rel="prefetch" href="/assets/js/58.0832ed49.js"><link rel="prefetch" href="/assets/js/59.326d0ed1.js"><link rel="prefetch" href="/assets/js/6.5931ecd3.js"><link rel="prefetch" href="/assets/js/60.e91910fb.js"><link rel="prefetch" href="/assets/js/61.93fcb862.js"><link rel="prefetch" href="/assets/js/62.8af0d998.js"><link rel="prefetch" href="/assets/js/63.535dc2ab.js"><link rel="prefetch" href="/assets/js/7.1fdc2758.js"><link rel="prefetch" href="/assets/js/8.d75c6c5f.js"><link rel="prefetch" href="/assets/js/9.a2e23ed2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bcf422a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.svg" alt="大前端" class="logo"> <span class="site-name can-hide">大前端</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/front/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/front/js/" class="nav-link router-link-active">
  javaScript
</a></li><li class="dropdown-item"><!----> <a href="/front/browser/" class="nav-link">
  browser
</a></li><li class="dropdown-item"><!----> <a href="/front/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/front/other/" class="nav-link">
  日常记录
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div> <a href="https://github.com/qsg1215/myitsky" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/front/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/front/js/" class="nav-link router-link-active">
  javaScript
</a></li><li class="dropdown-item"><!----> <a href="/front/browser/" class="nav-link">
  browser
</a></li><li class="dropdown-item"><!----> <a href="/front/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/front/other/" class="nav-link">
  日常记录
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div> <a href="https://github.com/qsg1215/myitsky" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>javaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/js/" class="sidebar-link">typeScript</a></li><li><a href="/front/js/ts.html" class="sidebar-link">typeScript 实践</a></li><li><a href="/front/js/zod使用文档.html" class="active sidebar-link">zod使用文档总结汇总</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#原始值类型（primitive）" class="sidebar-link">原始值类型（primitive）</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#字面量（literal）" class="sidebar-link">字面量（literal）</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#字符串" class="sidebar-link">字符串</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#numbers" class="sidebar-link">Numbers</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#dates" class="sidebar-link">Dates</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#objects" class="sidebar-link">Objects</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#shape" class="sidebar-link">.shape</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#extend" class="sidebar-link">.extend</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#merge" class="sidebar-link">.merge</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#pick-omit" class="sidebar-link">.pick/.omit</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#partial" class="sidebar-link">.partial</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#deeppartial" class="sidebar-link">.deepPartial</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#passthrough" class="sidebar-link">.passthrough</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#strict" class="sidebar-link">.strict</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#strip" class="sidebar-link">.strip</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#catchall" class="sidebar-link">.catchall</a></li></ul></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#arrays" class="sidebar-link">Arrays</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#nonempty" class="sidebar-link">.nonempty</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#min-max-length" class="sidebar-link">.min/.max/.length</a></li></ul></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#unions" class="sidebar-link">Unions</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#optionals" class="sidebar-link">Optionals</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#nullables" class="sidebar-link">Nullables</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#records" class="sidebar-link">Records</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#maps" class="sidebar-link">Maps</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#sets" class="sidebar-link">Sets</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#enums" class="sidebar-link">Enums</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#zod-enums" class="sidebar-link">Zod enums</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#native-enums" class="sidebar-link">Native enums</a></li></ul></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#intersections" class="sidebar-link">Intersections</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#tuples" class="sidebar-link">Tuples</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#recursive-types" class="sidebar-link">Recursive types</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#promises" class="sidebar-link">Promises</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#instanceof" class="sidebar-link">Instanceof</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#function-schemas" class="sidebar-link">Function schemas</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#parse" class="sidebar-link">.parse</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#parseasync" class="sidebar-link">.parseAsync</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#safeparse" class="sidebar-link">.safeParse</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#safeparseasync" class="sidebar-link">.safeParseAsync</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#refine" class="sidebar-link">.refine</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#superrefine" class="sidebar-link">.superRefine</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#transform" class="sidebar-link">.transform</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#default" class="sidebar-link">.default</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#optional" class="sidebar-link">.optional</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#nullable" class="sidebar-link">.nullable</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#nullish" class="sidebar-link">.nullish</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#array" class="sidebar-link">.array</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#or" class="sidebar-link">.or</a></li><li class="sidebar-sub-header"><a href="/front/js/zod使用文档.html#and" class="sidebar-link">.and</a></li></ul></li></ul></li><li><a href="/front/js/基础工具方法.html" class="sidebar-link">基础工具方法</a></li><li><a href="/front/js/数据结构和算法.html" class="sidebar-link">数据结构和算法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zod使用文档总结汇总"><a href="#zod使用文档总结汇总" class="header-anchor">#</a> zod使用文档总结汇总</h1> <h1 id="api概览"><a href="#api概览" class="header-anchor">#</a> API概览</h1> <ul><li><a href="#%E5%AE%89%E8%A3%85">安装</a></li> <li><a href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">基本用法</a></li> <li><a href="#%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%BC%8F">定义模式</a> <ul><li><a href="#%E5%8E%9F%E5%A7%8B%E5%80%BC%E7%B1%BB%E5%9E%8B%EF%BC%88primitive%EF%BC%89">原始值类型（primitive）</a></li> <li><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F%EF%BC%88literal%EF%BC%89">字面量（literal）</a></li> <li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2">字符串</a></li> <li><a href="#numbers">Numbers</a></li> <li><a href="#objects">Objects</a> <ul><li><a href="#shape">.shape</a></li> <li><a href="#extend">.extend</a></li> <li><a href="#merge">.merge</a></li> <li><a href="#pickomit">.pick/.omit</a></li> <li><a href="#partial">.partial</a></li> <li><a href="#deepPartial">.deepPartial</a></li> <li><a href="#passthrough">.passthrough</a></li> <li><a href="#strict">.strict</a></li> <li><a href="#strip">.strip</a></li> <li><a href="#catchall">.catchall</a></li></ul></li> <li><a href="#records">Records</a></li> <li><a href="#maps">Maps</a></li> <li><a href="#sets">Sets</a></li> <li><a href="#arrays">Arrays</a> <ul><li><a href="#nonempty">.nonempty</a></li> <li><a href="#minmaxlength">.min/.max/.length</a></li></ul></li> <li><a href="#unions">Unions</a></li> <li><a href="#optionals">Optionals</a></li> <li><a href="#nullables">Nullables</a></li> <li><a href="#enums">Enums</a> <ul><li><a href="#zod-enums">Zod enums</a></li> <li><a href="#native-enums">Native enums</a></li></ul></li> <li><a href="#tuples">Tuples</a></li> <li><a href="#recursive-types">Recursive types</a> <ul><li><a href="#json-type">JSON type</a></li> <li><a href="#cyclical-objects">Cyclical data</a></li></ul></li> <li><a href="#promises">Promises</a></li> <li><a href="#instanceof">Instanceof</a></li> <li><a href="#function-schemas">Function schemas</a></li></ul></li> <li><a href="#zodtype-methods-and-properties">基础类方法 (ZodType)</a> <ul><li><a href="#parse">.parse</a></li> <li><a href="#parseasync">.parseAsync</a></li> <li><a href="#safeparse">.safeParse</a></li> <li><a href="#safeparseasync">.safeParseAsync</a></li> <li><a href="#refine">.refine</a></li> <li><a href="#superRefine">.superRefine</a></li> <li><a href="#transform">.transform</a></li> <li><a href="#default">.default</a></li> <li><a href="#optional">.optional</a></li> <li><a href="#nullable">.nullable</a></li> <li><a href="#nullish">.nullish</a></li> <li><a href="#array">.array</a></li> <li><a href="#or">.or</a></li> <li><a href="#and">.and</a></li></ul></li> <li><a href="#type-inference">类型推断</a></li> <li><a href="#errors">Errors</a></li></ul> <h1 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h1> <h3 id="必要条件"><a href="#必要条件" class="header-anchor">#</a> 必要条件</h3> <ul><li>TypeScript 4.5+!</li> <li>你必须在你的<code>tsconfig.json</code>中启用<code>strict</code>模式。这是所有 TypeScript 项目的最佳实践。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token string">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="从npm安装"><a href="#从npm安装" class="header-anchor">#</a> 从<code>npm</code>安装</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> zod
<span class="token function">yarn</span> <span class="token function">add</span> zod          <span class="token comment"># yarn</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>README 的剩余部分假定你是直接通过 npm 安装的<code>zod</code>包。</p></blockquote> <h1 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法</h1> <p>创建一个简单的字符串模式</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zod&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个字符串的模式</span>
<span class="token keyword">const</span> mySchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 解析</span>
mySchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;tuna&quot;</span>
mySchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; throws ZodError</span>

<span class="token comment">// &quot;安全&quot;解析(如果验证失败不抛出错误)</span>
mySchema<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; { success: true; data: &quot;tuna&quot; }</span>
mySchema<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; { success: false; error: ZodError }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>创建一个 Object 模式</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zod&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> User <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

User<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">&quot;Ludwig&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 提取出推断的类型</span>
<span class="token keyword">type</span> User <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> User<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// { username: string }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="定义模式"><a href="#定义模式" class="header-anchor">#</a> 定义模式</h1> <h2 id="原始值类型（primitive）"><a href="#原始值类型（primitive）" class="header-anchor">#</a> 原始值类型（primitive）</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zod&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 原始值类型</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">bigint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 空类型</span>
z<span class="token punctuation">.</span><span class="token keyword">undefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token keyword">null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接受 undefined</span>

<span class="token comment">// 任意类型</span>
<span class="token comment">// 允许任意类型的值</span>
z<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// never 类型</span>
<span class="token comment">// 不允许值类型存在</span>
z<span class="token punctuation">.</span><span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="字面量（literal）"><a href="#字面量（literal）" class="header-anchor">#</a> 字面量（literal）</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> tuna <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> twelve <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tru <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">literal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检索字面量的值</span>
tuna<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// &quot;tuna&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>目前在 Zod 中不支持 Date 或 bigint 字面。如果你有这个功能的用例，请提交一个 Issue。</p></blockquote> <h2 id="字符串"><a href="#字符串" class="header-anchor">#</a> 字符串</h2> <p>Zod 包括一些针对字符串的验证。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">regex</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 已废弃，等同于 .min(1)</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>查看 <a href="https://github.com/validatorjs/validator.js" target="_blank" rel="noopener noreferrer">validator.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，了解其他一些有用的字符串验证函数</p></blockquote> <h4 id="自定义错误信息"><a href="#自定义错误信息" class="header-anchor">#</a> 自定义错误信息</h4> <p>你可以选择传入第二个参数来提供一个自定义的错误信息。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Must be 5 or more characters long&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Must be 5 or fewer characters long&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Must be exactly 5 characters long&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Invalid email address.&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Invalid url&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Invalid UUID&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;https://&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Must provide secure URL&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;.com&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Only .com domains allowed&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="numbers"><a href="#numbers" class="header-anchor">#</a> Numbers</h2> <p>Zod 包括一些特定的数字验证。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// alias .min(5)</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// alias .max(5)</span>

z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 值必须是一个整数</span>

z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">positive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//     &gt; 0</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nonnegative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  &gt;= 0</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//     &lt; 0</span>
z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nonpositive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  &lt;= 0</span>

z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multipleOf</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x % 5 === 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>你可以选择传入第二个参数来提供一个自定义的错误信息。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;this👏is👏too👏big&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="dates"><a href="#dates" class="header-anchor">#</a> Dates</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// success: true</span>

z<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  required_error<span class="token operator">:</span> <span class="token string">&quot;Please select a date and time&quot;</span><span class="token punctuation">,</span>
  invalid_type_error<span class="token operator">:</span> <span class="token string">&quot;That's not a date!&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

z<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&quot;1900-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Too old&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
z<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&quot;Too young!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="objects"><a href="#objects" class="header-anchor">#</a> Objects</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 所有属性都是默认需要的</span>
<span class="token keyword">const</span> Dog <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 像这样提取推断出的类型</span>
<span class="token keyword">type</span> Dog <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Dog<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// 相当于:</span>
<span class="token keyword">type</span> Dog <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="shape"><a href="#shape" class="header-anchor">#</a> <code>.shape</code></h3> <p>使用<code>.shape</code>来访问特定键的模式。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>Dog<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// =&gt; string schema</span>
Dog<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// =&gt; number schema</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="extend"><a href="#extend" class="header-anchor">#</a> <code>.extend</code></h3> <p>你可以用<code>.extend</code>方法在对象模式中添加额外的字段。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> DogWithBreed <span class="token operator">=</span> Dog<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  breed<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你可以使用<code>.extend</code>来覆盖字段! 要小心使用这种方式!</p> <h3 id="merge"><a href="#merge" class="header-anchor">#</a> <code>.merge</code></h3> <p>相当于 <code>A.extend(B.shape)</code>.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> BaseTeacher <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> students<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HasID <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Teacher <span class="token operator">=</span> BaseTeacher<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>HasID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> Teacher <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Teacher<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; { students: string[], id: string }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>如果两个模式共享 keys，那么 B 的属性将覆盖 A 的属性。返回的模式也继承了 &quot;unknownKeys 密钥 &quot;策略(strip/strict/passthrough+)和 B 的全面模式。</p></blockquote> <h3 id="pick-omit"><a href="#pick-omit" class="header-anchor">#</a> <code>.pick/.omit</code></h3> <p>受 TypeScript 内置的<code>Pick</code>和<code>Omit</code>工具类型的启发，所有 Zod 对象模式都有<code>.pick</code>和 <code>.omit</code>方法，可以返回一个修改后的版本。考虑一下这个 Recipe 模式。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> Recipe <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ingredients<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>要想只保留某些 Key，使用 <code>.pick</code> .</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> JustTheName <span class="token operator">=</span> Recipe<span class="token punctuation">.</span><span class="token function">pick</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> JustTheName <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> JustTheName<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { name: string }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>要删除某些 Key，请使用 <code>.omit</code> .</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> NoIDRecipe <span class="token operator">=</span> Recipe<span class="token punctuation">.</span><span class="token function">omit</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> NoIDRecipe <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> NoIDRecipe<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { name: string, ingredients: string[] }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="partial"><a href="#partial" class="header-anchor">#</a> <code>.partial</code></h3> <p>受 TypeScript 内置的实用类型<a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#partialtype" target="_blank" rel="noopener noreferrer">Partial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的启发, <code>.partial</code> 方法使所有属性都是可选的。</p> <p>从这个对象开始:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { username: string }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们可以创建一个 Partial 版本:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> partialUser <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">partial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { username?: string | undefined }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="deeppartial"><a href="#deeppartial" class="header-anchor">#</a> <code>.deepPartial</code></h3> <p>T<code>.partial</code> 只是一个浅层的使用 — 它只适用于一个层次的深度。还有一个 &quot;深层&quot; 版本:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  location<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    latitude<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    longitude<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> deepPartialUser <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">deepPartial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
{
  username?: string | undefined,
  location?: {
    latitude?: number | undefined;
    longitude?: number | undefined;
  } | undefined
}
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>重要的限制: <code>deep partials</code> 只在对象模式的直接层次中按预期工作。嵌套的对象模式不能是可选的，不能是空的，不能包含细化，不能包含转换，等等...</p></blockquote> <h4 id="未被识别的-keys"><a href="#未被识别的-keys" class="header-anchor">#</a> 未被识别的 keys</h4> <p>默认情况下，Zod 对象的模式在解析过程中会剥离出未被识别的 keys</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> person <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

person<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;bob dylan&quot;</span><span class="token punctuation">,</span>
  extraKey<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { name: &quot;bob dylan&quot; }</span>
<span class="token comment">// extraKey已经被剥离</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="passthrough"><a href="#passthrough" class="header-anchor">#</a> <code>.passthrough</code></h3> <p>相反，如果你想通过未知的 keys，使用<code>.passthrough()</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>person<span class="token punctuation">.</span><span class="token function">passthrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;bob dylan&quot;</span><span class="token punctuation">,</span>
  extraKey<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { name: &quot;bob dylan&quot;, extraKey: 61 }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="strict"><a href="#strict" class="header-anchor">#</a> <code>.strict</code></h3> <p>你可以用<code>.strict()</code>来 <em>禁止</em> 未知键。如果输入中存在任何未知的 keys，Zod 将抛出一个错误。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> person <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

person<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;bob dylan&quot;</span><span class="token punctuation">,</span>
  extraKey<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; throws ZodError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="strip"><a href="#strip" class="header-anchor">#</a> <code>.strip</code></h3> <p>你可以使用<code>.strip</code>方法将一个对象模式重置为默认行为(剥离未识别的 keys)。</p> <h3 id="catchall"><a href="#catchall" class="header-anchor">#</a> <code>.catchall</code></h3> <p>你可以将一个 &quot;catchall &quot;模式传递给一个对象模式。所有未知的 keys 都将根据它进行验证。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> person <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catchall</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

person<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;bob dylan&quot;</span><span class="token punctuation">,</span>
  validExtraKey<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token comment">// 运行良好</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

person<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;bob dylan&quot;</span><span class="token punctuation">,</span>
  validExtraKey<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 未能成功</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; throws ZodError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>使用<code>.catchall()</code>可以避免<code>.passthrough()</code>，<code>.strip()</code>，或<code>.strict()</code>。现在所有的键都被视为 &quot;已知(known)&quot;。</p> <h2 id="arrays"><a href="#arrays" class="header-anchor">#</a> Arrays</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringArray <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 相当于</span>
<span class="token keyword">const</span> stringArray <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>要小心使用<code>.array()</code>方法。它返回一个新的<code>ZodArray</code>实例。这意味着你调用方法的 <em>顺序</em> 很重要。比如说:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (string | undefined)[]</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string[] | undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="nonempty"><a href="#nonempty" class="header-anchor">#</a> <code>.nonempty</code></h3> <p>如果你想确保一个数组至少包含一个元素，使用 <code>.nonempty()</code>.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> nonEmptyStrings <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 现在推断的类型是</span>
<span class="token comment">// [string, ...string[]]</span>

nonEmptyStrings<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws: &quot;Array cannot be empty&quot;</span>
nonEmptyStrings<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Ariana Grande&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// passes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="min-max-length"><a href="#min-max-length" class="header-anchor">#</a> <code>.min/.max/.length</code></h3> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须包含5个或更多元素</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须包含5个或更少元素</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须正好包含5个元素</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>与<code>.nonempty()</code>不同，这些方法不会改变推断的类型。</p> <h2 id="unions"><a href="#unions" class="header-anchor">#</a> Unions</h2> <p>Zod 包括一个内置的<code>z.union</code>方法，用于合成 &quot;OR&quot; 类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringOrNumber <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

stringOrNumber<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
stringOrNumber<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Zod 将按照每个 &quot;选项&quot; 的顺序测试输入，并返回第一个成功验证的值。</p> <p>为了方便，你也可以使用<code>.or</code>方法:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringOrNumber <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="optionals"><a href="#optionals" class="header-anchor">#</a> Optionals</h2> <p>你可以用<code>z.optional()</code>使任何模式成为可选:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> schema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

schema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; returns undefined</span>
<span class="token keyword">type</span> <span class="token constant">A</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> schema<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string | undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>你可以用<code>.optional()</code>方法使一个现有的模式成为可选的:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token constant">C</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> user<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// { username?: string | undefined };</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="unwrap"><a href="#unwrap" class="header-anchor">#</a> <code>.unwrap</code></h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> optionalString <span class="token operator">=</span> stringSchema<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
optionalString<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> stringSchema<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="nullables"><a href="#nullables" class="header-anchor">#</a> Nullables</h2> <p>类似地，你可以这样创建 nullable 类型:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> nullableString <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nullableString<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;asdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;asdf&quot;</span>
nullableString<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你可以用<code>nullable</code>方法使一个现有的模式变成 nullable:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token constant">E</span> <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// equivalent to D</span>
<span class="token keyword">type</span> <span class="token constant">E</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> <span class="token constant">E</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string | null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="unwrap-2"><a href="#unwrap-2" class="header-anchor">#</a> <code>.unwrap</code></h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nullableString <span class="token operator">=</span> stringSchema<span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nullableString<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> stringSchema<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div> <h2 id="records"><a href="#records" class="header-anchor">#</a> Records</h2> <p>Record 模式用于验证诸如<code>{ [k: string]: number }</code>这样的类型。</p> <p>如果你想根据某种模式验证一个对象的 <em>value</em> ，但不关心 keys，使用`Record'。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> NumberCache <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> NumberCache <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> NumberCache<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { [k: string]: number }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这对于按 ID 存储或缓存项目特别有用。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> userSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userStoreSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span>userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> UserStore <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> userStoreSchema<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; type UserStore = { [ x: string ]: { name: string } }</span>

<span class="token keyword">const</span> userStore<span class="token operator">:</span> UserStore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

userStore<span class="token punctuation">[</span><span class="token string">&quot;77d2586b-9e8e-4ecf-8b21-ea7e0530eadd&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;Carlotta&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// passes</span>

userStore<span class="token punctuation">[</span><span class="token string">&quot;77d2586b-9e8e-4ecf-8b21-ea7e0530eadd&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  whatever<span class="token operator">:</span> <span class="token string">&quot;Ice cream sundae&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="关于数字键的说明"><a href="#关于数字键的说明" class="header-anchor">#</a> 关于数字键的说明</h4> <p>你可能期望<code>z.record()</code>接受两个参数，一个是 key，一个是 value。毕竟，TypeScript 的内置 Record 类型是这样的：<code>Record&lt;KeyType, ValueType&gt;</code> 。否则，你如何在 Zod 中表示 TypeScript 类型<code>Record&lt;number, any&gt;</code>？</p> <p>事实证明，TypeScript 围绕<code>[k: number]</code>的行为有点不直观:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> testMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>k<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> testMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">typeof</span> key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// prints: `1: string`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>正如你所看到的，JavaScript 会自动将所有对象 key 转换为字符串。</p> <p>由于 Zod 试图弥合静态类型和运行时类型之间的差距，提供一种创建带有数字键的记录模式的方法是没有意义的，因为在 JavaScript runtime 中没有数字键这回事。</p> <h2 id="maps"><a href="#maps" class="header-anchor">#</a> Maps</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringNumberMap <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> StringNumberMap <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> stringNumberMap<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type StringNumber = Map&lt;string, number&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="sets"><a href="#sets" class="header-anchor">#</a> Sets</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> numberSet <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> numberSet <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> numberSet<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Set&lt;number&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="enums"><a href="#enums" class="header-anchor">#</a> Enums</h2> <p>在 Zod 中，有两种方法来定义枚举。</p> <h3 id="zod-enums"><a href="#zod-enums" class="header-anchor">#</a> Zod enums</h3> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> FishEnum <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token keyword">enum</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;Salmon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tuna&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Trout&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> FishEnum <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> FishEnum<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// 'Salmon' | 'Tuna' | 'Trout'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你必须将数值数组直接传入<code>z.enum()</code>。这样做是不行的:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> fish <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Salmon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tuna&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Trout&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FishEnum <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token keyword">enum</span><span class="token punctuation">(</span>fish<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在这种情况下，Zod 无法推断出各个枚举元素；相反，推断出的类型将是 <code>string</code> 而不是<code>'Salmon'|'Tuna'|'Trout'</code>。</p> <p>另一种可行的方式是使用<code>as const</code>，这样 Zod 就可以推断出正确的类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token constant">VALUES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Salmon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tuna&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Trout&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FishEnum <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token keyword">enum</span><span class="token punctuation">(</span><span class="token constant">VALUES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>自动补全</strong></p> <p>为了获得 Zod 枚举的自动完成，请使用你的模式的<code>.enum</code>属性:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>FishEnum<span class="token punctuation">.</span><span class="token keyword">enum</span><span class="token punctuation">.</span>Salmon<span class="token punctuation">;</span> <span class="token comment">// =&gt; 自动补全</span>

FishEnum<span class="token punctuation">.</span><span class="token keyword">enum</span><span class="token punctuation">;</span>
<span class="token comment">/*
=&gt; {
  Salmon: &quot;Salmon&quot;,
  Tuna: &quot;Tuna&quot;,
  Trout: &quot;Trout&quot;,
}
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>你也可以用<code>.options</code>属性检索选项列表，作为一个元组:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>FishEnum<span class="token punctuation">.</span>options<span class="token punctuation">;</span> <span class="token comment">// [&quot;Salmon&quot;, &quot;Tuna&quot;, &quot;Trout&quot;]);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="native-enums"><a href="#native-enums" class="header-anchor">#</a> Native enums</h3> <p>Zod 枚举是定义和验证枚举的推荐方法。但是如果你需要对第三方库的枚举进行验证（或者你不想重写你现有的枚举），你可以使用<code>z.nativeEnum()</code>。</p> <p><strong>数字枚举</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">enum</span> Fruits <span class="token punctuation">{</span>
  Apple<span class="token punctuation">,</span>
  Banana<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> FruitEnum <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">nativeEnum</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> FruitEnum <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> FruitEnum<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Fruits</span>

FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">.</span>Apple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">.</span>Banana<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 未通过</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>String enums</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">enum</span> Fruits <span class="token punctuation">{</span>
  Apple <span class="token operator">=</span> <span class="token string">&quot;apple&quot;</span><span class="token punctuation">,</span>
  Banana <span class="token operator">=</span> <span class="token string">&quot;banana&quot;</span><span class="token punctuation">,</span>
  Cantaloupe<span class="token punctuation">,</span> <span class="token comment">// 你可以混合使用数字和字符串的枚举</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> FruitEnum <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">nativeEnum</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> FruitEnum <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> FruitEnum<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Fruits</span>

FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">.</span>Apple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">.</span>Cantaloupe<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;apple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;banana&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;Cantaloupe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 未通过</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>常量枚举</strong></p> <p><code>.nativeEnum()</code>函数也适用于<code>as const</code>对象。 ⚠️ <code>as const</code>需要 TypeScript 3.4+!</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> Fruits <span class="token operator">=</span> <span class="token punctuation">{</span>
  Apple<span class="token operator">:</span> <span class="token string">&quot;apple&quot;</span><span class="token punctuation">,</span>
  Banana<span class="token operator">:</span> <span class="token string">&quot;banana&quot;</span><span class="token punctuation">,</span>
  Cantaloupe<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> FruitEnum <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">nativeEnum</span><span class="token punctuation">(</span>Fruits<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> FruitEnum <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> FruitEnum<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// &quot;apple&quot; | &quot;banana&quot; | 3</span>

FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;apple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// passes</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;banana&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// passes</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// passes</span>
FruitEnum<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;Cantaloupe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fails</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="intersections"><a href="#intersections" class="header-anchor">#</a> Intersections</h2> <p>交叉类型对于创建 &quot;logical AND&quot;类型很有用。这对于两个对象类型的相交很有用。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> Person <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Employee <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  role<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> EmployedPerson <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> Employee<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// equivalent to:</span>
<span class="token keyword">const</span> EmployedPerson <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>Employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>虽然在很多情况下，建议使用<code>A.merge(B)</code>来合并两个对象。<code>.merge</code>方法返回一个新的<code>ZodObject</code>实例，而<code>A.and(B)</code>返回一个不太有用的<code>ZodIntersection</code>实例，它缺乏像<code>pick</code>和<code>omit</code>这样的常用对象方法。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> a <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> c <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> c<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div> <h2 id="tuples"><a href="#tuples" class="header-anchor">#</a> Tuples</h2> <p>与数组不同，tuples 有固定数量的元素，每个元素可以有不同的类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> athleteSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// name</span>
  z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// jersey number</span>
  z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pointsScored<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// statistics</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> Athlete <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> athleteSchema<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type Athlete = [string, number, { pointsScored: number }]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="recursive-types"><a href="#recursive-types" class="header-anchor">#</a> Recursive types</h2> <p>你可以在 Zod 中定义一个递归模式，但由于 TypeScript 的限制，它们的类型不能被静态推断。相反，你需要手动定义类型，并将其作为 &quot;类型提示&quot; 提供给 Zod。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Category</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  subcategories<span class="token operator">:</span> Category<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// cast to z.ZodSchema&lt;Category&gt;</span>
<span class="token keyword">const</span> Category<span class="token operator">:</span> z<span class="token punctuation">.</span>ZodSchema<span class="token operator">&lt;</span>Category<span class="token operator">&gt;</span> <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    subcategories<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>Category<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Category<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;People&quot;</span><span class="token punctuation">,</span>
  subcategories<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Politicians&quot;</span><span class="token punctuation">,</span>
      subcategories<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Presidents&quot;</span><span class="token punctuation">,</span> subcategories<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>不幸的是，这段代码有点重复，因为你声明了两次类型：一次在接口中，另一次在 Zod 定义中。</p> <h4 id="json-type"><a href="#json-type" class="header-anchor">#</a> JSON type</h4> <p>如果你想验证任何 JSON 值，你可以使用下面的片段。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> literalSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token keyword">null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> Literal <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> literalSchema<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> Json <span class="token operator">=</span> Literal <span class="token operator">|</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> Json <span class="token punctuation">}</span> <span class="token operator">|</span> Json<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jsonSchema<span class="token operator">:</span> z<span class="token punctuation">.</span>ZodSchema<span class="token operator">&lt;</span>Json<span class="token operator">&gt;</span> <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  z<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>literalSchema<span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>jsonSchema<span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span>jsonSchema<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

jsonSchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="cyclical-objects"><a href="#cyclical-objects" class="header-anchor">#</a> Cyclical objects</h4> <p>尽管支持递归模式，但将一个循环数据传入 Zod 会导致无限循环。</p> <h2 id="promises"><a href="#promises" class="header-anchor">#</a> Promises</h2> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> numberPromise <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>&quot;Parsing&quot;的工作方式与 promise 模式有点不同。验证分两部分进行:</p> <ol><li>Zod 同步检查输入是否是 Promise 的实例(即一个具有<code>.then</code>和<code>.catch</code>方法的对象)。</li> <li>Zod 使用<code>.then</code>在现有的 Promise 上附加一个额外的验证步骤。你必须在返回的 Promise 上使用<code>.catch</code>来处理验证失败的问题。</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>numberPromise<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ZodError: Non-Promise type: string</span>

numberPromise<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; Promise&lt;number&gt;</span>

<span class="token keyword">const</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> numberPromise<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ZodError: Non-number type: string</span>

  <span class="token keyword">await</span> numberPromise<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// =&gt; 3.14</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div> <h2 id="instanceof"><a href="#instanceof" class="header-anchor">#</a> Instanceof</h2> <p>你可以使用<code>z.instanceof</code>来检查输入是否是一个类的实例。这对于验证从第三方库中导出的类的输入很有用。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> TestSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token keyword">instanceof</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> blob<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token string">&quot;whatever&quot;</span><span class="token punctuation">;</span>
TestSchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// passes</span>
TestSchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;blob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="function-schemas"><a href="#function-schemas" class="header-anchor">#</a> Function schemas</h2> <p>Zod 还允许你定义 &quot;函数模式(function schemas)&quot;。这使得验证一个函数的输入和输出变得很容易，而不需要把验证代码和 &quot;业务逻辑(business logic)&quot;混在一起。</p> <p>你可以用<code>z.function(args, returnType)</code>创建一个函数模式。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> myFunction <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> myFunction <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> myFunction<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; ()=&gt;unknown</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>定义输入和输出</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> myFunction <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 接受任意数量的参数</span>
  <span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> myFunction <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> myFunction<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; (arg0: string, arg1: number)=&gt;boolean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>提取输入和输出模式</strong>
你可以提取一个函数模式的参数和返回类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>myFunction<span class="token punctuation">.</span><span class="token function">parameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; ZodTuple&lt;[ZodString, ZodNumber]&gt;</span>

myFunction<span class="token punctuation">.</span><span class="token function">returnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; ZodBoolean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>函数模式有一个<code>.implement()</code>方法，它接受一个函数并返回一个自动验证其输入和输出的新函数。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> trimmedLength <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// accepts an arbitrary number of arguments</span>
  <span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">implement</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// TypeScript knows x is a string!</span>
    <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">trimmedLength</span><span class="token punctuation">(</span><span class="token string">&quot;sandwich&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 8</span>
<span class="token function">trimmedLength</span><span class="token punctuation">(</span><span class="token string">&quot; asdf &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果你只关心验证输入，那就好了:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> myFunction <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">implement</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>arg<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myFunction<span class="token punctuation">;</span> <span class="token comment">// (arg: string)=&gt;number[]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="zodtype-methods-and-properties"><a href="#zodtype-methods-and-properties" class="header-anchor">#</a> ZodType: methods and properties</h1> <p>所有的 Zod 模式都包含一些方法。</p> <h3 id="parse"><a href="#parse" class="header-anchor">#</a> <code>.parse</code></h3> <p><code>.parse(data:unknown): T</code></p> <p>给定任何 Zod 模式，你可以调用其<code>.parse</code>方法来检查<code>data</code>是否有效。如果是的话，就会返回一个带有完整类型信息的值。否则，会产生一个错误。</p> <blockquote><p>IMPORTANT: 在 Zod 2 和 Zod 1.11+中，<code>.parse</code>返回的值是你传入的变量的 <em>deep clone</em> 。这在zod@1.4 和更早的版本中也是如此。</p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringSchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;fish&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; returns &quot;fish&quot;</span>
stringSchema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws Error('Non-string type: number');</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="parseasync"><a href="#parseasync" class="header-anchor">#</a> <code>.parseAsync</code></h3> <p><code>.parseAsync(data:unknown): Promise&lt;T&gt;</code></p> <p>如果你使用异步的<a href="#refine">refinements</a>或<a href="#transform">transforms</a>（后面会有更多介绍），你需要使用<code>.parseAsync</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> stringSchema<span class="token punctuation">.</span><span class="token function">parseAsync</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; hello</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="safeparse"><a href="#safeparse" class="header-anchor">#</a> <code>.safeParse</code></h3> <p><code>.safeParse(data:unknown): { success: true; data: T; } | { success: false; error: ZodError; }</code></p> <p>如果你不希望 Zod 在验证失败时抛出错误，请使用<code>.safeParse</code>。该方法返回一个包含成功解析的数据的对象，或者一个包含验证问题详细信息的 ZodError 实例。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>stringSchema<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { success: false; error: ZodError }</span>

stringSchema<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token string">&quot;billie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; { success: true; data: 'billie' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>结果是一个 <em>discriminated union</em> ，所以你可以非常方便地处理错误:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> result <span class="token operator">=</span> stringSchema<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token string">&quot;billie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle error then return</span>
  result<span class="token punctuation">.</span>error<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  result<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="safeparseasync"><a href="#safeparseasync" class="header-anchor">#</a> <code>.safeParseAsync</code></h3> <blockquote><p>Alias: <code>.spa</code></p></blockquote> <p>一个异步版本的<code>safeParse</code>。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">await</span> stringSchema<span class="token punctuation">.</span><span class="token function">safeParseAsync</span><span class="token punctuation">(</span><span class="token string">&quot;billie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>为方便起见，它已被别名为<code>.spa</code>:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">await</span> stringSchema<span class="token punctuation">.</span><span class="token function">spa</span><span class="token punctuation">(</span><span class="token string">&quot;billie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="refine"><a href="#refine" class="header-anchor">#</a> <code>.refine</code></h3> <p><code>.refine(validator: (data:T)=&gt;any, params?: RefineParams)</code></p> <p>Zod 允许你通过 <em>refinements</em> 提供自定义验证逻辑。(关于创建多个问题和自定义错误代码等高级功能，见<a href="#superrefine"><code>.superRefine</code></a>)。</p> <p>Zod 被设计为尽可能地反映 TypeScript。但有许多所谓的 &quot;细化类型&quot;，你可能希望检查不能在 TypeScript 的类型系统中表示。例如：检查一个数字是否是一个整数，或者一个字符串是否是一个有效的电子邮件地址。</p> <p>例如，你可以用<code>.refine</code>对任何 Zod 模式定义一个自定义验证检查:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> myString <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token string">&quot;String can't be more than 255 characters&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>⚠️ 精细化函数不应该抛出。相反，它们应该返回一个虚假的值来表示失败。</p></blockquote> <h4 id="arguments"><a href="#arguments" class="header-anchor">#</a> Arguments</h4> <p>正如你所看到的，<code>.refine</code>需要两个参数。</p> <ol><li>第一个是验证函数。这个函数接受一个输入（类型为<code>T</code>--模式的推断类型）并返回<code>any</code>。任何真实的值都会通过验证。(在zod@1.6.2 之前，验证函数必须返回一个布尔值。)</li> <li>第二个参数接受一些选项。你可以用它来定制某些错误处理行为:</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> RefineParams <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 覆盖错误信息</span>
  message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token comment">// 附加到错误路径中</span>
  path<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// params对象，你可以用它来定制消息</span>
  <span class="token comment">// 在错误map中</span>
  params<span class="token operator">?</span><span class="token operator">:</span> object<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>对于高级情况，第二个参数也可以是一个返回<code>RefineParams</code>的函数</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not more than 10 characters</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="customize-error-path"><a href="#customize-error-path" class="header-anchor">#</a> Customize error path</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> passwordForm <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    password<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    confirm<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data<span class="token punctuation">.</span>password <span class="token operator">===</span> data<span class="token punctuation">.</span>confirm<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">&quot;Passwords don't match&quot;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;confirm&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// path of error</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">{</span> password<span class="token operator">:</span> <span class="token string">&quot;asdf&quot;</span><span class="token punctuation">,</span> confirm<span class="token operator">:</span> <span class="token string">&quot;qwer&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>因为你提供了一个<code>路径(path)</code>参数，产生的错误将是:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>ZodError <span class="token punctuation">{</span>
  issues<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;path&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;confirm&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Passwords don't match&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="asynchronous-refinements"><a href="#asynchronous-refinements" class="header-anchor">#</a> Asynchronous refinements</h4> <p>细化也可以是异步的:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> userId <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// verify that ID exists in database</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>⚠️ 如果你使用异步细化，你必须使用<code>.parseAsync</code>方法来解析数据! 否则 Zod 会抛出一个错误。</p></blockquote> <h4 id="relationship-to-transforms"><a href="#relationship-to-transforms" class="header-anchor">#</a> Relationship to transforms</h4> <p>变换(transforms)和细化(refinements)可以交错进行:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token operator">&gt;</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="superrefine"><a href="#superrefine" class="header-anchor">#</a> <code>.superRefine</code></h3> <p><code>.refine</code>方法实际上是在一个更通用的（也更啰嗦）的<code>superRefine</code>方法之上的语法糖。下面是一个例子:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> Strings <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">superRefine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">addIssue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      code<span class="token operator">:</span> z<span class="token punctuation">.</span>ZodIssueCode<span class="token punctuation">.</span>too_big<span class="token punctuation">,</span>
      maximum<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
      inclusive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">&quot;Too many items 😡&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">addIssue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      code<span class="token operator">:</span> z<span class="token punctuation">.</span>ZodIssueCode<span class="token punctuation">.</span>custom<span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">No duplicated allowed.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>你可以随心所欲地添加问题(issues)。如果<code>ctx.addIssue</code>在函数的执行过程中没有被调用，则验证通过。</p> <p>通常情况下，细化总是创建具有<code>ZodIssueCode.custom</code>错误代码的问题，但通过<code>superRefine</code>你可以创建任何代码的任何问题。每个问题代码在错误处理指南 <a href="/front/js/ERROR_HANDLING.html">ERROR_HANDLING.md</a> 中都有详细描述。</p> <h3 id="transform"><a href="#transform" class="header-anchor">#</a> <code>.transform</code></h3> <p>要在解析后转换数据，请使用<code>transform</code>方法。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringToNumber <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> myString<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
stringToNumber<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>⚠️ 转化函数不得抛出。确保在转化器之前使用细化功能，以确保输入可以被转化器解析。</p></blockquote> <h4 id="chaining-order"><a href="#chaining-order" class="header-anchor">#</a> Chaining order</h4> <p>注意，上面的<code>stringToNumber</code>是<code>ZodEffects</code>子类的一个实例。它不是<code>ZodString</code>的实例。如果你想使用<code>ZodString</code>的内置方法（例如<code>.email()</code>），你必须在进行任何转换 <em>之前</em> 应用这些方法。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> emailToDomain <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

emailToDomain<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;colinhacks@example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; example.com</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="relationship-to-refinements"><a href="#relationship-to-refinements" class="header-anchor">#</a> Relationship to refinements</h4> <p>转换和细化可以交错进行:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token operator">&gt;</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="async-transformations"><a href="#async-transformations" class="header-anchor">#</a> Async transformations</h4> <p>转换也可以是异步的。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> IdToUser <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>⚠️ 如果你的模式包含异步变换器，你必须使用.parseAsync()或.safeParseAsync()来解析数据。否则，Zod 将抛出一个错误。</p></blockquote> <h3 id="default"><a href="#default" class="header-anchor">#</a> <code>.default</code></h3> <p>你可以使用变换器来实现 Zod 中 &quot;默认值 &quot;的概念。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringWithDefault <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token string">&quot;tuna&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

stringWithDefault<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;tuna&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你可以选择在<code>.default</code>中传递一个函数，当需要生成默认值时，该函数将被重新执行:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> numberWithRandomDefault <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>

numberWithRandomDefault<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 0.4413456736055323</span>
numberWithRandomDefault<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 0.1871840107401901</span>
numberWithRandomDefault<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 0.7223408162401552</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="optional"><a href="#optional" class="header-anchor">#</a> <code>.optional</code></h3> <p>一个方便的方法，返回一个模式的可选版本。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> optionalString <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string | undefined</span>

<span class="token comment">// equivalent to</span>
z<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="nullable"><a href="#nullable" class="header-anchor">#</a> <code>.nullable</code></h3> <p>一个方便的方法，返回一个模式的可空版本。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> nullableString <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string | null</span>

<span class="token comment">// equivalent to</span>
z<span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="nullish"><a href="#nullish" class="header-anchor">#</a> <code>.nullish</code></h3> <p>一个方便的方法，用于返回模式的 &quot;nullish &quot;版本。空白模式将同时接受<code>undefined</code>和<code>null</code>。阅读更多关于 &quot;nullish &quot;的概念<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#nullish-coalescing" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> nullishString <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nullish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string | null | undefined</span>

<span class="token comment">// equivalent to</span>
z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="array"><a href="#array" class="header-anchor">#</a> <code>.array</code></h3> <p>一个方便的方法，为给定类型返回一个数组模式:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> nullableString <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string[]</span>

<span class="token comment">// equivalent to</span>
z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="or"><a href="#or" class="header-anchor">#</a> <code>.or</code></h3> <p>一个用于联合类型的方便方法。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string | number</span>

<span class="token comment">// equivalent to</span>
z<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="and"><a href="#and" class="header-anchor">#</a> <code>.and</code></h3> <p>一个方便的方法，用于创建交叉类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { name: string } &amp; { age: number }</span>

<span class="token comment">// equivalent to</span>
z<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h1 id="type-inference"><a href="#type-inference" class="header-anchor">#</a> Type inference</h1> <p>你可以用<code>z.infer&lt;typeof mySchema&gt;</code>提取任何模式的 TypeScript 类型。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token constant">A</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string</span>

<span class="token keyword">const</span> u<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
<span class="token keyword">const</span> u<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token string">&quot;asdf&quot;</span><span class="token punctuation">;</span> <span class="token comment">// compiles</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="what-about-transforms"><a href="#what-about-transforms" class="header-anchor">#</a> What about transforms?</h4> <p>在现实中，每个 Zod 模式实际上都与<strong>两种</strong>类型相关：一个输入和一个输出。对于大多数模式（例如<code>z.string()</code>），这两种类型是相同的。但是一旦你把转换添加到混合中，这两个值就会发生分歧。例如，<code>z.string().transform(val =&gt; val.length)</code>的输入为<code>string</code>，输出为<code>number</code>。</p> <p>你可以像这样分别提取输入和输出类型:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> stringToNumber <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ⚠️ Important: z.infer返回OUTPUT类型!</span>
<span class="token keyword">type</span> input <span class="token operator">=</span> z<span class="token punctuation">.</span>input<span class="token operator">&lt;</span>stringToNumber<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
<span class="token keyword">type</span> output <span class="token operator">=</span> z<span class="token punctuation">.</span>output<span class="token operator">&lt;</span>stringToNumber<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// number</span>

<span class="token comment">// equivalent to z.output!</span>
<span class="token keyword">type</span> inferred <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span>stringToNumber<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="errors"><a href="#errors" class="header-anchor">#</a> Errors</h1> <p>Zod 提供了一个名为 <code>ZodError</code> 的错误子类。ZodErrors 包含一个<code>issues</code> 数组，包含关于验证问题的详细信息。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> data <span class="token operator">=</span> z
  <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span>error<span class="token punctuation">.</span>issues<span class="token punctuation">;</span>
  <span class="token comment">/* [
      {
        &quot;code&quot;: &quot;invalid_type&quot;,
        &quot;expected&quot;: &quot;string&quot;,
        &quot;received&quot;: &quot;number&quot;,
        &quot;path&quot;: [ &quot;name&quot; ],
        &quot;message&quot;: &quot;Expected string, received number&quot;
      }
  ] */</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="error-formatting"><a href="#error-formatting" class="header-anchor">#</a> Error formatting</h4> <p>你可以使用<code>.format()</code>方法将这个错误转换为一个嵌套对象。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>data<span class="token punctuation">.</span>error<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* {
  name: { _errors: [ 'Expected string, received number' ] }
} */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">7/5/2025, 11:30:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front/js/ts.html" class="prev">
        typeScript 实践
      </a></span> <span class="next"><a href="/front/js/基础工具方法.html">
        基础工具方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cb69e367.js" defer></script><script src="/assets/js/2.97e62447.js" defer></script><script src="/assets/js/19.e931611d.js" defer></script>
  </body>
</html>
